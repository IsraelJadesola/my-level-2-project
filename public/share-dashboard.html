<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h1>My Dashboard</h1>

    <div id="showMe"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
        import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAGcO2LxrrjCCUaahQcEANaC6gqTDzoilc",
            authDomain: "lvl-2-project.firebaseapp.com",
            databaseURL: "https://lvl-2-project-default-rtdb.firebaseio.com",
            projectId: "lvl-2-project",
            storageBucket: "lvl-2-project.firebasestorage.app",
            messagingSenderId: "114438653075",
            appId: "1:114438653075:web:08eef3dffa7abc593b7966"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in. Now we can get their ID.
                const userId = user.uid;
                // fetchUserData(userId); // Call the function to fetch data
                console.log(userId)
                console.log();

            } else {
                // User is signed out, redirect them to the login page
                window.location.href = "sign-up-hub.html";
            }
        });

        function fetchUserData(userId) {
            // 1. Reference the data path using the user's UID
            const userRef = ref(database, `signedUpUsers/${userId}`);

            // 2. Fetch the data once
            get(userRef)
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        // snapshot.val() contains the user's saved data object
                        const userData = snapshot.val();

                        // 3. Find your HTML elements (e.g., assumed IDs)
                        const welcomeElement = document.getElementById('showMe');
                        const emailElement = document.getElementById('displayEmail');
                        const locationElement = document.getElementById('displayLocation');

                        // 4. Display the data
                        if (welcomeElement) {
                            welcomeElement.textContent = `Welcome, ${userData.name}!`;
                        }
                        if (emailElement) {
                            emailElement.textContent = userData.email;
                        }
                        if (locationElement) {
                            locationElement.textContent = userData.location;
                        }
                    } else {
                        console.log("No donor data found for this user.");
                    }
                })
                .catch((error) => {
                    console.error("Error fetching user data:", error);
                });
        }

        fetchUserData()
    </script>
</body>

</html>