<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Share Food</title>
  <link rel="stylesheet" href="./styles/bootstrap.css">

</head>

<body>
  <div class="card mx-auto col-sm-10 col-md-6 p-4 mt-5">
    <h1 class="text-center">Share Your Excess</h1>
    <input type="text" placeholder="input your name here" class="form-control mb-3" id="donorName">
    <input type="email" placeholder="input your email here" class="form-control mb-3" id="donorMail">
    <input type="password" placeholder="input your password here" class="form-control mb-3" id="donorPassword">
    <input type="tel" placeholder="input your phone number here" class="form-control mb-3" id="donorPhoneNumber">
    <input type="text" placeholder="input your location here e.g (ogbomosho)" class="form-control mb-3"
      id="donorAddress">

    <button class="btn btn-success" onclick="createDonator()" id="donate">Register as a Donator</button>

  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAGcO2LxrrjCCUaahQcEANaC6gqTDzoilc",
      authDomain: "lvl-2-project.firebaseapp.com",
      databaseURL: "https://lvl-2-project-default-rtdb.firebaseio.com",
      projectId: "lvl-2-project",
      storageBucket: "lvl-2-project.firebasestorage.app",
      messagingSenderId: "114438653075",
      appId: "1:114438653075:web:08eef3dffa7abc593b7966"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);


    function createDonator() {
      const donatorName = document.getElementById('donorName').value;
      const donatorEmail = document.getElementById('donorMail').value;
      const donatorPhoneNo = document.getElementById('donorPhoneNumber').value;
      const donatorPassword = document.getElementById('donorPassword').value;
      const donatorLocation = document.getElementById('donorAddress').value;


      if (!donatorName || !donatorEmail || !donatorPassword || !donatorPhoneNo || !donatorLocation) {
        alert('Please fill all fields correctly')
      } else {
        createUserWithEmailAndPassword(auth, donatorEmail, donatorPassword)
          .then((userCredential) => {
            const user = userCredential.user;

            const donorId = {
              id: user.uid,
              name: donatorName,
              email: donatorEmail,
              phoneNumber: donatorPhoneNo,
              location: donatorLocation
            }

            const signUp = ref(database, `signedUpUsers/${user.uid}`)

            set(signUp, donorId)
              .then((newSignUp) => {
                console.log('New donor added')
                window.location.href = "share-dashboard.html"
              })
              .catch((error) => {
                error.console('failed to save data')
              })

            console.log(donorId)
            console.log(user)
          })
          .catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
            // ..
            console.log(errorMessage)
            console.log(errorCode)
          });
      }
    }
    window.createDonator = createDonator

  </script>

</body>

</html>