<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    <h1>My Dashboard</h1>

    <div id="displayName">Loading user data...</div>
    <p>Email: <span id="displayEmail"></span></p>
    <p>Location: <span id="displayLocation"></span></p>

    <br>
    <br>

    <input type="text" id="foodName" placeholder="food name"><br><br>
    <input type="text" id="foodMeasurement" placeholder="food measurement"><br><br>
    <input type="number" id="foodQuantity" placeholder="food quantity"><br><br>

    <button onclick="postFood()"> Post Your Food Items</button>

    <div>
        <p id="showFoodName"></p>
        <p id="showFoodMeasurement"></p>
        <p id="showFoodQuantity"></p>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
        import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAGcO2LxrrjCCUaahQcEANaC6gqTDzoilc",
            authDomain: "lvl-2-project.firebaseapp.com",
            databaseURL: "https://lvl-2-project-default-rtdb.firebaseio.com",
            projectId: "lvl-2-project",
            storageBucket: "lvl-2-project.firebasestorage.app",
            messagingSenderId: "114438653075",
            appId: "1:114438653075:web:08eef3dffa7abc593b7966"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                const userId = user.uid;

                fetchUserData(userId);
                console.log(userId)

            } else {
                window.location.href = "sign-up-hub.html";
            }
        });

        function fetchUserData(userId) {
            const userRef = ref(database, `signedUpUsers/${userId}`);

            get(userRef)
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        const userData = snapshot.val();

                        const welcomeElement = document.getElementById('displayName');
                        const emailElement = document.getElementById('displayEmail');
                        const locationElement = document.getElementById('displayLocation');

                        if (welcomeElement) {
                            welcomeElement.textContent = `Welcome, ${userData.name}!`;
                        }
                        if (emailElement) {
                            emailElement.textContent = userData.email;
                        }
                        if (locationElement) {
                            locationElement.textContent = userData.location;
                        }
                    } else {
                        console.log("No donor data found for this user.");
                    }
                })
                .catch((error) => {
                    console.error("Error fetching user data:", error);
                });
        }

        function postFood() {
            // alert('working')

            const donorFoodName = document.getElementById("foodName").value
            const donorFoodMeasurement = document.getElementById("foodMeasurement").value
            const donorFoodQuantity = document.getElementById("foodQuantity").value

            const postObject = {
                donorFoodName,
                donorFoodMeasurement,
                donorFoodQuantity,
            }
            console.log(postObject)

            const foodDonorToDatabase = ref(database, `donorFoodDetails`)
            set(foodDonorToDatabase, postObject)

        }

        window.postFood = postFood
    </script>
</body>

</html>